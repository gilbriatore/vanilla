<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vanilla</title>
</head>
<body>
    <h1>App Vanilla</h1>
    <button id="btnArquivo">Carregar arquivo.json</button>
    <button id="btnAPI">Requisitar API produtos json</button>
    <button id="btnImagem">Carregar imagem</button>
    <button id="btnProdutos">Cadastrar produtos</button>
    <main>
        <!--Conteúdo inserido pelo código javascript-->
    </main>
    <script>

        function vincularClick(){
            var btnSalvar = document.getElementById('btnSalvar');
            btnSalvar.onclick = ()=> {
                var form = new FormData(document.getElementById('frmProdutos'));
                var nome = form.get('nome');
                var desc = form.get('desc');

                var json = {
                    "nome": nome,
                    "desc": desc
                };

                fetch("/produtos", {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                method: "POST",
                    body: JSON.stringify(json)
                });
            } 
        }
        
        function carregarHTML(url, elemento) {
                fetch(url).then((resposta) => {
                    return resposta.text();
                }).then((html) => {
                   elemento.innerHTML = html;
                }).then(()=>{
                    vincularClick();
                });
            }

        function carregarJson(url){
            fetch(url)
            .then((resposta)=> {
                return resposta.json();
            })
            .then((json)=>{
                criarLista(json);
            })
        }

        function carregarJsonTabela(url){
            fetch(url)
            .then((resposta)=> {
                return resposta.json();
            })
            .then((json)=>{
                gerarTabela(json);
            })
        }




        function gerarTabela(produtos) {

            // get the reference for the main
            var main = document.getElementsByTagName('main')[0];

            var btnIncluir = document.createElement("button");
            btnIncluir.innerText = "Incluir";
            btnIncluir.onclick = ()=> {
                carregarHTML('form.html', main);
            }

            main.appendChild(btnIncluir);


            // creates a <table> element and a <tbody> element
            var tbl = document.createElement("table");
            var tblBody = document.createElement("tbody");


            var qtdeLinhas = produtos.length;
            var qtdeColunas = 4;

            // Gerar as linhas da tabela
            for (var i = 0; i < qtdeLinhas; i++) {
                var produto = produtos[i];


                var row = document.createElement("tr");

                // Gerar as colunas da tabela

                var cell = document.createElement("td");
                var cellText = document.createTextNode(produto.id);
                cell.appendChild(cellText);
                row.appendChild(cell);


                var cell = document.createElement("td");
                var cellText = document.createTextNode(produto.nome);
                cell.appendChild(cellText);
                row.appendChild(cell);


                var cell = document.createElement("td");
                var cellText = document.createTextNode(produto.desc);
                cell.appendChild(cellText);
                row.appendChild(cell);


                var cell = document.createElement("td");
                var cellText = document.createTextNode("Ações");
                cell.appendChild(cellText);
                row.appendChild(cell);




                // for (var j = 0; j < qtdeColunas; j++) {
                                
                // var cell = document.createElement("td");
                // var cellText = document.createTextNode("cell in row "+i+", column "+j);
                // cell.appendChild(cellText);
                // row.appendChild(cell);
                // }

                // add the row to the end of the table body
                tblBody.appendChild(row);
            }

            // put the <tbody> in the <table>
            tbl.appendChild(tblBody);
            // appends <table> into <main>
            main.appendChild(tbl);
            // sets the border attribute of tbl to 2;
            tbl.setAttribute("border", "2");
        }



        var main = document.getElementsByTagName('main')[0];

        function criarLista(produtos){
            const lista = document.createElement('ul');
            for (const produto of produtos) {
                const item = document.createElement('li');
                item.innerText = produto.nome;   
                lista.appendChild(item);                                     
            }
            main.appendChild(lista);
        }
        
        var btnArquivo = document.getElementById('btnArquivo');
        var btnAPI = document.getElementById('btnAPI');
        var btnImagem = document.getElementById('btnImagem');
        var btnProdutos = document.getElementById('btnProdutos');
        
        

        function carregarImagem(url){
            fetch(url)
            .then((resposta)=> {
                return resposta.blob();
            })
            .then((imgCarregada)=>{
                var imgElemento = document.createElement('img');
                imgElemento.src = URL.createObjectURL(imgCarregada);
                main.appendChild(imgElemento);
            })
        }

        btnImagem.onclick = ()=>{
            carregarImagem('imgs/carne1.jpg');
        }

        btnArquivo.onclick = ()=>{           
            carregarJson('data/arquivo.json');
        }

        btnAPI.onclick = ()=>{           
            carregarJson('http://localhost:3000/produtos');
        }

        btnProdutos.onclick = ()=> {
            carregarJsonTabela('http://localhost:3000/produtos');
        }
    </script>
</body>
</html>